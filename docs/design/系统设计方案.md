# JSite 快速开发平台 - 系统设计方案

> 版本：1.0.0
> 创建日期：2026-01-15
> 架构模式：前后端分离

---

## 目录

1. [项目概述](#1-项目概述)
2. [系统架构设计](#2-系统架构设计)
3. [技术栈选型](#3-技术栈选型)
4. [模块划分](#4-模块划分)
5. [数据库设计](#5-数据库设计)
6. [权限管理设计](#6-权限管理设计)
7. [菜单配置设计](#7-菜单配置设计)
8. [代码生成器设计](#8-代码生成器设计)
9. [API设计规范](#9-api设计规范)
10. [前端架构设计](#10-前端架构设计)
11. [部署方案](#11-部署方案)
12. [开发规范](#12-开发规范)

---

## 1. 项目概述

### 1.1 项目背景

JSite 是一套基于 Spring Boot 3 + Vue 3 的企业级快速开发平台，采用前后端分离架构，提供代码生成、权限管理、菜单配置等核心功能，帮助开发者快速构建企业应用。

### 1.2 设计目标

| 目标 | 描述 |
|------|------|
| **快速开发** | 通过代码生成器，10分钟完成单表CRUD |
| **权限精细** | 支持菜单权限、按钮权限、数据权限三层控制 |
| **易于扩展** | 模块化设计，支持业务模块热插拔 |
| **多数据库** | 支持 MySQL、PostgreSQL、Oracle、SQL Server 等 |
| **前后分离** | 前后端独立开发、独立部署、独立扩展 |

### 1.3 核心功能

```
JSite 快速开发平台
├── 系统管理
│   ├── 用户管理（员工用户、会员用户）
│   ├── 角色管理（角色分配、权限授权）
│   ├── 菜单管理（菜单配置、权限标识）
│   ├── 部门管理（组织架构、树形结构）
│   ├── 岗位管理（岗位定义、角色绑定）
│   └── 字典管理（数据字典、字典类型）
├── 权限管理
│   ├── 菜单权限（动态菜单加载）
│   ├── 按钮权限（细粒度控制）
│   └── 数据权限（行级数据隔离）
├── 代码生成
│   ├── 数据表导入
│   ├── 字段配置
│   ├── 模板选择
│   └── 代码预览与下载
├── 系统监控
│   ├── 在线用户
│   ├── 操作日志
│   ├── 登录日志
│   └── 系统信息
└── 开发工具
    ├── 表单设计器
    ├── 接口文档
    └── 数据库文档
```

---

## 2. 系统架构设计

### 2.1 整体架构图

```
┌─────────────────────────────────────────────────────────────────┐
│                        客户端层                                  │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐          │
│  │   Web浏览器   │  │   移动端APP   │  │   小程序     │          │
│  └──────────────┘  └──────────────┘  └──────────────┘          │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼ HTTP/HTTPS
┌─────────────────────────────────────────────────────────────────┐
│                        网关层 (可选)                             │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │              Nginx / Spring Cloud Gateway                 │  │
│  │         负载均衡、SSL终结、静态资源、反向代理              │  │
│  └──────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
                              │
            ┌─────────────────┴─────────────────┐
            ▼                                   ▼
┌───────────────────────┐         ┌───────────────────────────────┐
│      前端应用层        │         │          后端服务层            │
│  ┌─────────────────┐  │         │  ┌─────────────────────────┐  │
│  │   jsite-ui     │  │         │  │      jsite-admin        │  │
│  │   (Vue 3)      │  │  REST   │  │    (Spring Boot 3)      │  │
│  │                │  │◄──────►│  │                         │  │
│  │  ┌───────────┐ │  │  API   │  │  ┌───────────────────┐  │  │
│  │  │ 系统管理  │ │  │         │  │  │   Controller层    │  │  │
│  │  │ 权限管理  │ │  │         │  │  │   (REST API)     │  │  │
│  │  │ 代码生成  │ │  │         │  │  ├───────────────────┤  │  │
│  │  │ 系统监控  │ │  │         │  │  │   Service层       │  │  │
│  │  └───────────┘ │  │         │  │  │   (业务逻辑)      │  │  │
│  │                │  │         │  │  ├───────────────────┤  │  │
│  │  Vite + TS    │  │         │  │  │   Dao层           │  │  │
│  │  Pinia        │  │         │  │  │   (MyBatis-Plus)  │  │  │
│  │  Vue Router   │  │         │  │  └───────────────────┘  │  │
│  │  Ant Design   │  │         │  │                         │  │
│  └─────────────────┘  │         │  │  Sa-Token (认证授权)   │  │
└───────────────────────┘         │  │  Druid (连接池)        │  │
                                  │  └─────────────────────────┘  │
                                  └───────────────────────────────┘
                                                │
                                                ▼
                                  ┌───────────────────────────────┐
                                  │          数据层                │
                                  │  ┌─────────┐  ┌─────────────┐ │
                                  │  │  MySQL  │  │    Redis    │ │
                                  │  │ 主数据库 │  │  缓存/会话   │ │
                                  │  └─────────┘  └─────────────┘ │
                                  └───────────────────────────────┘
```

### 2.2 后端分层架构

```
jsite-admin (后端服务)
│
├── Controller层 (web)
│   ├── 接收HTTP请求
│   ├── 参数校验 (@Validated)
│   ├── 权限检查 (@SaCheckPermission)
│   └── 返回统一响应 (R<T>)
│
├── Service层 (service)
│   ├── 业务逻辑处理
│   ├── 事务管理 (@Transactional)
│   ├── 数据权限过滤
│   └── 缓存处理 (@Cacheable)
│
├── Dao层 (mapper)
│   ├── MyBatis-Plus Mapper
│   ├── 动态SQL
│   └── 多数据源支持
│
├── Entity层 (entity)
│   ├── 数据库实体 (DO)
│   ├── 数据传输对象 (DTO)
│   ├── 视图对象 (VO)
│   └── 查询对象 (Query)
│
└── Common层 (common)
    ├── 统一响应封装
    ├── 全局异常处理
    ├── 工具类库
    └── 常量定义
```

### 2.3 前端分层架构

```
jsite-ui (前端应用)
│
├── views (页面视图层)
│   ├── 页面组件
│   ├── 业务逻辑
│   └── 数据展示
│
├── components (通用组件层)
│   ├── 基础组件
│   ├── 业务组件
│   └── 布局组件
│
├── store (状态管理层)
│   ├── 用户状态
│   ├── 权限状态
│   ├── 应用配置
│   └── 标签页状态
│
├── router (路由层)
│   ├── 静态路由
│   ├── 动态路由
│   └── 路由守卫
│
├── api (接口层)
│   ├── 接口定义
│   ├── 请求封装
│   └── 响应处理
│
├── hooks (组合式函数)
│   ├── 业务hooks
│   ├── 工具hooks
│   └── 组件hooks
│
└── utils (工具层)
    ├── 请求工具
    ├── 存储工具
    └── 通用工具
```

---

## 3. 技术栈选型

### 3.1 后端技术栈

| 类别 | 技术 | 版本 | 说明 |
|------|------|------|------|
| **基础框架** | Spring Boot | 3.2.x | 应用开发框架 |
| **安全框架** | Sa-Token | 1.37.x | 轻量级认证授权框架 |
| **ORM框架** | MyBatis-Plus | 3.5.x | MyBatis增强工具 |
| **数据库连接池** | Druid | 1.2.x | 高性能连接池 |
| **缓存** | Redis + Redisson | 7.x | 分布式缓存与锁 |
| **接口文档** | Knife4j | 4.x | Swagger增强UI |
| **参数校验** | Hibernate Validator | 8.x | JSR380校验 |
| **工具库** | Hutool | 5.8.x | Java工具类库 |
| **JSON处理** | Jackson | 2.15.x | JSON序列化 |
| **Excel处理** | EasyExcel | 3.x | Excel读写工具 |
| **模板引擎** | FreeMarker | 2.3.x | 代码生成模板 |
| **日志框架** | Logback | 1.4.x | 日志记录 |
| **数据库版本** | Flyway | 9.x | 数据库迁移 |

### 3.2 前端技术栈

| 类别 | 技术 | 版本 | 说明 |
|------|------|------|------|
| **基础框架** | Vue.js | 3.4.x | 渐进式JavaScript框架 |
| **开发语言** | TypeScript | 5.x | 类型安全 |
| **构建工具** | Vite | 5.x | 下一代前端构建工具 |
| **UI框架** | Ant Design Vue | 4.x | 企业级UI组件库 |
| **状态管理** | Pinia | 2.x | Vue官方状态管理 |
| **路由** | Vue Router | 4.x | 官方路由管理 |
| **HTTP客户端** | Axios | 1.6.x | HTTP请求库 |
| **图表** | ECharts | 5.x | 数据可视化 |
| **富文本** | TinyMCE | 6.x | 富文本编辑器 |
| **代码编辑** | Monaco Editor | 0.45.x | 代码编辑器 |
| **CSS预处理** | Less | 4.x | CSS扩展语言 |
| **代码规范** | ESLint + Prettier | - | 代码格式化 |

### 3.3 数据库支持

| 数据库 | 版本要求 | 说明 |
|--------|---------|------|
| MySQL | 8.0+ | 主推，功能完整 |
| PostgreSQL | 14+ | 支持 |
| Oracle | 19c+ | 支持 |
| SQL Server | 2019+ | 支持 |
| 达梦 | DM8 | 国产化支持 |
| 人大金仓 | V8 | 国产化支持 |

---

## 4. 模块划分

### 4.1 后端模块结构

```
jsite/
├── jsite-admin/                    # 后端主应用
│   ├── src/main/java/
│   │   └── com/jsite/
│   │       ├── JsiteApplication.java      # 启动类
│   │       ├── common/                     # 通用模块
│   │       │   ├── config/                # 配置类
│   │       │   ├── constant/              # 常量定义
│   │       │   ├── core/                  # 核心类
│   │       │   │   ├── domain/           # 基础实体
│   │       │   │   │   ├── BaseEntity.java
│   │       │   │   │   ├── TreeEntity.java
│   │       │   │   │   └── R.java        # 统一响应
│   │       │   │   ├── page/             # 分页封装
│   │       │   │   └── controller/       # 基础控制器
│   │       │   ├── exception/             # 异常处理
│   │       │   │   ├── ServiceException.java
│   │       │   │   └── GlobalExceptionHandler.java
│   │       │   ├── utils/                 # 工具类
│   │       │   │   ├── StringUtils.java
│   │       │   │   ├── DateUtils.java
│   │       │   │   ├── SecurityUtils.java
│   │       │   │   └── TreeUtils.java
│   │       │   ├── annotation/            # 自定义注解
│   │       │   │   ├── Log.java          # 操作日志
│   │       │   │   ├── DataScope.java    # 数据权限
│   │       │   │   └── RateLimiter.java  # 限流
│   │       │   └── aspect/                # 切面
│   │       │       ├── LogAspect.java
│   │       │       └── DataScopeAspect.java
│   │       │
│   │       ├── modules/                    # 业务模块
│   │       │   ├── system/                # 系统管理模块
│   │       │   │   ├── controller/
│   │       │   │   │   ├── SysUserController.java
│   │       │   │   │   ├── SysRoleController.java
│   │       │   │   │   ├── SysMenuController.java
│   │       │   │   │   ├── SysDeptController.java
│   │       │   │   │   ├── SysPostController.java
│   │       │   │   │   ├── SysDictController.java
│   │       │   │   │   └── SysConfigController.java
│   │       │   │   ├── service/
│   │       │   │   │   ├── ISysUserService.java
│   │       │   │   │   ├── impl/
│   │       │   │   │   │   └── SysUserServiceImpl.java
│   │       │   │   │   └── ...
│   │       │   │   ├── mapper/
│   │       │   │   │   ├── SysUserMapper.java
│   │       │   │   │   └── xml/
│   │       │   │   │       └── SysUserMapper.xml
│   │       │   │   ├── entity/
│   │       │   │   │   ├── SysUser.java
│   │       │   │   │   ├── SysRole.java
│   │       │   │   │   ├── SysMenu.java
│   │       │   │   │   ├── SysDept.java
│   │       │   │   │   ├── SysPost.java
│   │       │   │   │   └── SysDict.java
│   │       │   │   └── dto/
│   │       │   │       ├── SysUserDTO.java
│   │       │   │       └── LoginDTO.java
│   │       │   │
│   │       │   ├── monitor/               # 系统监控模块
│   │       │   │   ├── controller/
│   │       │   │   │   ├── SysLogController.java
│   │       │   │   │   ├── SysLoginLogController.java
│   │       │   │   │   └── OnlineUserController.java
│   │       │   │   ├── service/
│   │       │   │   ├── mapper/
│   │       │   │   └── entity/
│   │       │   │       ├── SysOperLog.java
│   │       │   │       └── SysLoginLog.java
│   │       │   │
│   │       │   └── gen/                   # 代码生成模块
│   │       │       ├── controller/
│   │       │       │   └── GenController.java
│   │       │       ├── service/
│   │       │       │   ├── IGenTableService.java
│   │       │       │   └── impl/
│   │       │       │       └── GenTableServiceImpl.java
│   │       │       ├── mapper/
│   │       │       │   ├── GenTableMapper.java
│   │       │       │   └── GenTableColumnMapper.java
│   │       │       ├── entity/
│   │       │       │   ├── GenTable.java
│   │       │       │   └── GenTableColumn.java
│   │       │       ├── template/          # 代码模板
│   │       │       │   ├── java/
│   │       │       │   │   ├── controller.java.ftl
│   │       │       │   │   ├── service.java.ftl
│   │       │       │   │   ├── serviceImpl.java.ftl
│   │       │       │   │   ├── mapper.java.ftl
│   │       │       │   │   └── entity.java.ftl
│   │       │       │   ├── xml/
│   │       │       │   │   └── mapper.xml.ftl
│   │       │       │   └── vue/
│   │       │       │       ├── index.vue.ftl
│   │       │       │       ├── form.vue.ftl
│   │       │       │       └── api.ts.ftl
│   │       │       └── util/
│   │       │           ├── GenUtils.java
│   │       │           └── VelocityUtils.java
│   │       │
│   │       └── framework/                  # 框架模块
│   │           ├── security/              # 安全配置
│   │           │   ├── config/
│   │           │   │   └── SaTokenConfig.java
│   │           │   ├── handler/
│   │           │   │   └── SaTokenExceptionHandler.java
│   │           │   └── service/
│   │           │       └── SysLoginService.java
│   │           ├── mybatis/               # MyBatis配置
│   │           │   ├── config/
│   │           │   │   └── MybatisPlusConfig.java
│   │           │   └── handler/
│   │           │       └── MyMetaObjectHandler.java
│   │           └── web/                   # Web配置
│   │               ├── config/
│   │               │   ├── WebMvcConfig.java
│   │               │   └── CorsConfig.java
│   │               └── filter/
│   │                   └── RepeatableFilter.java
│   │
│   └── src/main/resources/
│       ├── application.yml                # 主配置文件
│       ├── application-dev.yml            # 开发环境配置
│       ├── application-prod.yml           # 生产环境配置
│       ├── logback-spring.xml             # 日志配置
│       └── db/
│           └── migration/                 # Flyway迁移脚本
│               ├── V1.0.0__init.sql
│               └── V1.0.1__add_index.sql
│
└── pom.xml                                # Maven配置
```

### 4.2 前端模块结构

```
jsite-ui/
├── src/
│   ├── api/                        # 接口定义
│   │   ├── system/
│   │   │   ├── user.ts            # 用户管理接口
│   │   │   ├── role.ts            # 角色管理接口
│   │   │   ├── menu.ts            # 菜单管理接口
│   │   │   ├── dept.ts            # 部门管理接口
│   │   │   ├── post.ts            # 岗位管理接口
│   │   │   └── dict.ts            # 字典管理接口
│   │   ├── monitor/
│   │   │   ├── operLog.ts         # 操作日志接口
│   │   │   ├── loginLog.ts        # 登录日志接口
│   │   │   └── online.ts          # 在线用户接口
│   │   ├── gen/
│   │   │   └── gen.ts             # 代码生成接口
│   │   └── login.ts               # 登录接口
│   │
│   ├── assets/                     # 静态资源
│   │   ├── icons/                 # 图标
│   │   ├── images/                # 图片
│   │   └── styles/                # 全局样式
│   │       ├── index.less
│   │       └── variables.less
│   │
│   ├── components/                 # 通用组件
│   │   ├── Icon/                  # 图标组件
│   │   ├── Table/                 # 表格组件
│   │   │   ├── src/
│   │   │   │   └── BasicTable.vue
│   │   │   └── index.ts
│   │   ├── Form/                  # 表单组件
│   │   │   ├── src/
│   │   │   │   └── BasicForm.vue
│   │   │   └── index.ts
│   │   ├── Tree/                  # 树组件
│   │   ├── Modal/                 # 弹窗组件
│   │   ├── Upload/                # 上传组件
│   │   ├── Editor/                # 编辑器组件
│   │   └── Dict/                  # 字典组件
│   │       ├── src/
│   │       │   ├── DictTag.vue
│   │       │   └── DictSelect.vue
│   │       └── index.ts
│   │
│   ├── directives/                 # 自定义指令
│   │   ├── permission.ts          # 权限指令 v-permission
│   │   ├── role.ts                # 角色指令 v-role
│   │   └── loading.ts             # 加载指令
│   │
│   ├── hooks/                      # 组合式函数
│   │   ├── web/
│   │   │   ├── usePermission.ts   # 权限hook
│   │   │   ├── useDict.ts         # 字典hook
│   │   │   └── useTable.ts        # 表格hook
│   │   └── core/
│   │       └── useContext.ts
│   │
│   ├── layouts/                    # 布局组件
│   │   ├── default/               # 默认布局
│   │   │   ├── index.vue
│   │   │   ├── header/
│   │   │   │   └── index.vue
│   │   │   ├── sider/
│   │   │   │   └── index.vue
│   │   │   ├── content/
│   │   │   │   └── index.vue
│   │   │   └── tabs/
│   │   │       └── index.vue
│   │   └── blank/                 # 空白布局
│   │       └── index.vue
│   │
│   ├── router/                     # 路由配置
│   │   ├── index.ts               # 路由实例
│   │   ├── routes/
│   │   │   ├── index.ts           # 路由汇总
│   │   │   ├── modules/           # 静态路由模块
│   │   │   │   └── base.ts
│   │   │   └── dynamic.ts         # 动态路由处理
│   │   ├── guard/
│   │   │   ├── index.ts           # 路由守卫
│   │   │   └── permissionGuard.ts # 权限守卫
│   │   └── helper/
│   │       └── menuHelper.ts      # 菜单辅助
│   │
│   ├── store/                      # 状态管理
│   │   ├── index.ts               # Store实例
│   │   └── modules/
│   │       ├── user.ts            # 用户状态
│   │       ├── permission.ts      # 权限状态
│   │       ├── app.ts             # 应用状态
│   │       └── tabs.ts            # 标签页状态
│   │
│   ├── utils/                      # 工具函数
│   │   ├── http/                  # HTTP请求
│   │   │   ├── axios.ts           # Axios封装
│   │   │   └── index.ts
│   │   ├── auth/
│   │   │   └── index.ts           # 认证工具
│   │   ├── cache/
│   │   │   └── index.ts           # 缓存工具
│   │   ├── tree.ts                # 树形工具
│   │   └── index.ts
│   │
│   ├── views/                      # 页面视图
│   │   ├── login/                 # 登录页
│   │   │   └── index.vue
│   │   ├── dashboard/             # 仪表盘
│   │   │   └── index.vue
│   │   ├── system/                # 系统管理
│   │   │   ├── user/
│   │   │   │   ├── index.vue      # 用户列表
│   │   │   │   └── UserForm.vue   # 用户表单
│   │   │   ├── role/
│   │   │   │   ├── index.vue
│   │   │   │   └── RoleForm.vue
│   │   │   ├── menu/
│   │   │   │   ├── index.vue
│   │   │   │   └── MenuForm.vue
│   │   │   ├── dept/
│   │   │   │   ├── index.vue
│   │   │   │   └── DeptForm.vue
│   │   │   ├── post/
│   │   │   │   └── index.vue
│   │   │   └── dict/
│   │   │       ├── index.vue
│   │   │       └── data.vue
│   │   ├── monitor/               # 系统监控
│   │   │   ├── operLog/
│   │   │   │   └── index.vue
│   │   │   ├── loginLog/
│   │   │   │   └── index.vue
│   │   │   └── online/
│   │   │       └── index.vue
│   │   ├── gen/                   # 代码生成
│   │   │   ├── index.vue          # 生成列表
│   │   │   ├── editTable.vue      # 编辑配置
│   │   │   └── preview.vue        # 代码预览
│   │   └── error/                 # 错误页面
│   │       ├── 404.vue
│   │       └── 500.vue
│   │
│   ├── App.vue                     # 根组件
│   ├── main.ts                     # 入口文件
│   └── env.d.ts                    # 类型声明
│
├── public/                         # 公共资源
│   └── favicon.ico
│
├── index.html                      # HTML模板
├── vite.config.ts                  # Vite配置
├── tsconfig.json                   # TypeScript配置
├── package.json                    # 依赖配置
└── .env.development                # 开发环境变量
```

---

## 5. 数据库设计

### 5.1 数据库命名规范

| 类型 | 规范 | 示例 |
|------|------|------|
| 表名 | 小写+下划线，模块前缀 | sys_user, sys_role |
| 字段名 | 小写+下划线 | user_name, create_time |
| 主键 | id 或 业务主键 | id, user_id |
| 外键 | 关联表名_id | role_id, dept_id |
| 索引 | idx_表名_字段 | idx_user_name |
| 唯一索引 | uk_表名_字段 | uk_user_login_name |

### 5.2 通用字段设计

所有业务表应包含以下通用字段：

```sql
-- 通用字段
id              BIGINT          PRIMARY KEY     -- 主键ID
create_by       VARCHAR(64)     DEFAULT ''      -- 创建者
create_time     DATETIME        DEFAULT NOW()   -- 创建时间
update_by       VARCHAR(64)     DEFAULT ''      -- 更新者
update_time     DATETIME        DEFAULT NOW()   -- 更新时间
remark          VARCHAR(500)    DEFAULT ''      -- 备注
del_flag        CHAR(1)         DEFAULT '0'     -- 删除标志(0正常 1删除)
```

### 5.3 树形结构字段设计

支持树形结构的表应包含以下字段：

```sql
-- 树形结构字段
parent_id       BIGINT          DEFAULT 0       -- 父级ID
ancestors       VARCHAR(500)    DEFAULT ''      -- 祖级列表(逗号分隔)
tree_sort       INT             DEFAULT 0       -- 显示顺序
tree_level      INT             DEFAULT 1       -- 层级
tree_leaf       CHAR(1)         DEFAULT '1'     -- 是否叶子节点(0否 1是)
```

### 5.4 核心表设计

#### 5.4.1 用户表 (sys_user)

```sql
CREATE TABLE sys_user (
    id              BIGINT          NOT NULL AUTO_INCREMENT COMMENT '用户ID',
    dept_id         BIGINT          DEFAULT NULL COMMENT '部门ID',
    login_name      VARCHAR(30)     NOT NULL COMMENT '登录账号',
    user_name       VARCHAR(30)     NOT NULL COMMENT '用户昵称',
    user_type       VARCHAR(10)     DEFAULT 'sys' COMMENT '用户类型(sys系统用户)',
    email           VARCHAR(50)     DEFAULT '' COMMENT '邮箱',
    phone           VARCHAR(11)     DEFAULT '' COMMENT '手机号',
    sex             CHAR(1)         DEFAULT '0' COMMENT '性别(0未知 1男 2女)',
    avatar          VARCHAR(200)    DEFAULT '' COMMENT '头像路径',
    password        VARCHAR(100)    DEFAULT '' COMMENT '密码',
    salt            VARCHAR(20)     DEFAULT '' COMMENT '盐加密',
    status          CHAR(1)         DEFAULT '0' COMMENT '状态(0正常 1停用)',
    login_ip        VARCHAR(128)    DEFAULT '' COMMENT '最后登录IP',
    login_time      DATETIME        DEFAULT NULL COMMENT '最后登录时间',
    pwd_update_time DATETIME        DEFAULT NULL COMMENT '密码更新时间',
    create_by       VARCHAR(64)     DEFAULT '' COMMENT '创建者',
    create_time     DATETIME        DEFAULT NOW() COMMENT '创建时间',
    update_by       VARCHAR(64)     DEFAULT '' COMMENT '更新者',
    update_time     DATETIME        DEFAULT NOW() COMMENT '更新时间',
    remark          VARCHAR(500)    DEFAULT '' COMMENT '备注',
    del_flag        CHAR(1)         DEFAULT '0' COMMENT '删除标志',
    PRIMARY KEY (id),
    UNIQUE KEY uk_login_name (login_name)
) ENGINE=InnoDB COMMENT='用户表';
```

#### 5.4.2 角色表 (sys_role)

```sql
CREATE TABLE sys_role (
    id              BIGINT          NOT NULL AUTO_INCREMENT COMMENT '角色ID',
    role_name       VARCHAR(30)     NOT NULL COMMENT '角色名称',
    role_key        VARCHAR(100)    NOT NULL COMMENT '角色权限字符串',
    role_sort       INT             NOT NULL COMMENT '显示顺序',
    data_scope      CHAR(1)         DEFAULT '1' COMMENT '数据范围(1全部 2自定义 3本部门 4本部门及以下 5仅本人)',
    status          CHAR(1)         DEFAULT '0' COMMENT '状态(0正常 1停用)',
    create_by       VARCHAR(64)     DEFAULT '' COMMENT '创建者',
    create_time     DATETIME        DEFAULT NOW() COMMENT '创建时间',
    update_by       VARCHAR(64)     DEFAULT '' COMMENT '更新者',
    update_time     DATETIME        DEFAULT NOW() COMMENT '更新时间',
    remark          VARCHAR(500)    DEFAULT '' COMMENT '备注',
    del_flag        CHAR(1)         DEFAULT '0' COMMENT '删除标志',
    PRIMARY KEY (id),
    UNIQUE KEY uk_role_key (role_key)
) ENGINE=InnoDB COMMENT='角色表';
```

#### 5.4.3 菜单表 (sys_menu)

```sql
CREATE TABLE sys_menu (
    id              BIGINT          NOT NULL AUTO_INCREMENT COMMENT '菜单ID',
    menu_name       VARCHAR(50)     NOT NULL COMMENT '菜单名称',
    parent_id       BIGINT          DEFAULT 0 COMMENT '父菜单ID',
    ancestors       VARCHAR(500)    DEFAULT '' COMMENT '祖级列表',
    order_num       INT             DEFAULT 0 COMMENT '显示顺序',
    path            VARCHAR(200)    DEFAULT '' COMMENT '路由地址',
    component       VARCHAR(255)    DEFAULT NULL COMMENT '组件路径',
    query           VARCHAR(255)    DEFAULT NULL COMMENT '路由参数',
    is_frame        CHAR(1)         DEFAULT '1' COMMENT '是否外链(0是 1否)',
    is_cache        CHAR(1)         DEFAULT '0' COMMENT '是否缓存(0缓存 1不缓存)',
    menu_type       CHAR(1)         DEFAULT '' COMMENT '菜单类型(M目录 C菜单 F按钮)',
    visible         CHAR(1)         DEFAULT '0' COMMENT '显示状态(0显示 1隐藏)',
    status          CHAR(1)         DEFAULT '0' COMMENT '菜单状态(0正常 1停用)',
    perms           VARCHAR(100)    DEFAULT NULL COMMENT '权限标识',
    icon            VARCHAR(100)    DEFAULT '#' COMMENT '菜单图标',
    create_by       VARCHAR(64)     DEFAULT '' COMMENT '创建者',
    create_time     DATETIME        DEFAULT NOW() COMMENT '创建时间',
    update_by       VARCHAR(64)     DEFAULT '' COMMENT '更新者',
    update_time     DATETIME        DEFAULT NOW() COMMENT '更新时间',
    remark          VARCHAR(500)    DEFAULT '' COMMENT '备注',
    PRIMARY KEY (id)
) ENGINE=InnoDB COMMENT='菜单权限表';
```

#### 5.4.4 部门表 (sys_dept)

```sql
CREATE TABLE sys_dept (
    id              BIGINT          NOT NULL AUTO_INCREMENT COMMENT '部门ID',
    parent_id       BIGINT          DEFAULT 0 COMMENT '父部门ID',
    ancestors       VARCHAR(500)    DEFAULT '' COMMENT '祖级列表',
    dept_name       VARCHAR(30)     DEFAULT '' COMMENT '部门名称',
    order_num       INT             DEFAULT 0 COMMENT '显示顺序',
    leader          VARCHAR(20)     DEFAULT NULL COMMENT '负责人',
    phone           VARCHAR(11)     DEFAULT NULL COMMENT '联系电话',
    email           VARCHAR(50)     DEFAULT NULL COMMENT '邮箱',
    status          CHAR(1)         DEFAULT '0' COMMENT '部门状态(0正常 1停用)',
    create_by       VARCHAR(64)     DEFAULT '' COMMENT '创建者',
    create_time     DATETIME        DEFAULT NOW() COMMENT '创建时间',
    update_by       VARCHAR(64)     DEFAULT '' COMMENT '更新者',
    update_time     DATETIME        DEFAULT NOW() COMMENT '更新时间',
    del_flag        CHAR(1)         DEFAULT '0' COMMENT '删除标志',
    PRIMARY KEY (id)
) ENGINE=InnoDB COMMENT='部门表';
```

#### 5.4.5 岗位表 (sys_post)

```sql
CREATE TABLE sys_post (
    id              BIGINT          NOT NULL AUTO_INCREMENT COMMENT '岗位ID',
    post_code       VARCHAR(64)     NOT NULL COMMENT '岗位编码',
    post_name       VARCHAR(50)     NOT NULL COMMENT '岗位名称',
    post_sort       INT             NOT NULL COMMENT '显示顺序',
    status          CHAR(1)         DEFAULT '0' COMMENT '状态(0正常 1停用)',
    create_by       VARCHAR(64)     DEFAULT '' COMMENT '创建者',
    create_time     DATETIME        DEFAULT NOW() COMMENT '创建时间',
    update_by       VARCHAR(64)     DEFAULT '' COMMENT '更新者',
    update_time     DATETIME        DEFAULT NOW() COMMENT '更新时间',
    remark          VARCHAR(500)    DEFAULT '' COMMENT '备注',
    del_flag        CHAR(1)         DEFAULT '0' COMMENT '删除标志',
    PRIMARY KEY (id),
    UNIQUE KEY uk_post_code (post_code)
) ENGINE=InnoDB COMMENT='岗位表';
```

#### 5.4.6 用户角色关联表 (sys_user_role)

```sql
CREATE TABLE sys_user_role (
    user_id         BIGINT          NOT NULL COMMENT '用户ID',
    role_id         BIGINT          NOT NULL COMMENT '角色ID',
    PRIMARY KEY (user_id, role_id)
) ENGINE=InnoDB COMMENT='用户角色关联表';
```

#### 5.4.7 角色菜单关联表 (sys_role_menu)

```sql
CREATE TABLE sys_role_menu (
    role_id         BIGINT          NOT NULL COMMENT '角色ID',
    menu_id         BIGINT          NOT NULL COMMENT '菜单ID',
    PRIMARY KEY (role_id, menu_id)
) ENGINE=InnoDB COMMENT='角色菜单关联表';
```

#### 5.4.8 角色部门关联表 (sys_role_dept)

```sql
CREATE TABLE sys_role_dept (
    role_id         BIGINT          NOT NULL COMMENT '角色ID',
    dept_id         BIGINT          NOT NULL COMMENT '部门ID',
    PRIMARY KEY (role_id, dept_id)
) ENGINE=InnoDB COMMENT='角色部门关联表';
```

#### 5.4.9 用户岗位关联表 (sys_user_post)

```sql
CREATE TABLE sys_user_post (
    user_id         BIGINT          NOT NULL COMMENT '用户ID',
    post_id         BIGINT          NOT NULL COMMENT '岗位ID',
    PRIMARY KEY (user_id, post_id)
) ENGINE=InnoDB COMMENT='用户岗位关联表';
```

#### 5.4.10 字典类型表 (sys_dict_type)

```sql
CREATE TABLE sys_dict_type (
    id              BIGINT          NOT NULL AUTO_INCREMENT COMMENT '字典ID',
    dict_name       VARCHAR(100)    DEFAULT '' COMMENT '字典名称',
    dict_type       VARCHAR(100)    DEFAULT '' COMMENT '字典类型',
    status          CHAR(1)         DEFAULT '0' COMMENT '状态(0正常 1停用)',
    create_by       VARCHAR(64)     DEFAULT '' COMMENT '创建者',
    create_time     DATETIME        DEFAULT NOW() COMMENT '创建时间',
    update_by       VARCHAR(64)     DEFAULT '' COMMENT '更新者',
    update_time     DATETIME        DEFAULT NOW() COMMENT '更新时间',
    remark          VARCHAR(500)    DEFAULT '' COMMENT '备注',
    PRIMARY KEY (id),
    UNIQUE KEY uk_dict_type (dict_type)
) ENGINE=InnoDB COMMENT='字典类型表';
```

#### 5.4.11 字典数据表 (sys_dict_data)

```sql
CREATE TABLE sys_dict_data (
    id              BIGINT          NOT NULL AUTO_INCREMENT COMMENT '字典数据ID',
    dict_sort       INT             DEFAULT 0 COMMENT '字典排序',
    dict_label      VARCHAR(100)    DEFAULT '' COMMENT '字典标签',
    dict_value      VARCHAR(100)    DEFAULT '' COMMENT '字典键值',
    dict_type       VARCHAR(100)    DEFAULT '' COMMENT '字典类型',
    css_class       VARCHAR(100)    DEFAULT '' COMMENT '样式属性',
    list_class      VARCHAR(100)    DEFAULT '' COMMENT '表格样式',
    is_default      CHAR(1)         DEFAULT 'N' COMMENT '是否默认(Y是 N否)',
    status          CHAR(1)         DEFAULT '0' COMMENT '状态(0正常 1停用)',
    create_by       VARCHAR(64)     DEFAULT '' COMMENT '创建者',
    create_time     DATETIME        DEFAULT NOW() COMMENT '创建时间',
    update_by       VARCHAR(64)     DEFAULT '' COMMENT '更新者',
    update_time     DATETIME        DEFAULT NOW() COMMENT '更新时间',
    remark          VARCHAR(500)    DEFAULT '' COMMENT '备注',
    PRIMARY KEY (id),
    KEY idx_dict_type (dict_type)
) ENGINE=InnoDB COMMENT='字典数据表';
```

#### 5.4.12 系统配置表 (sys_config)

```sql
CREATE TABLE sys_config (
    id              BIGINT          NOT NULL AUTO_INCREMENT COMMENT '参数ID',
    config_name     VARCHAR(100)    DEFAULT '' COMMENT '参数名称',
    config_key      VARCHAR(100)    DEFAULT '' COMMENT '参数键名',
    config_value    VARCHAR(500)    DEFAULT '' COMMENT '参数键值',
    config_type     CHAR(1)         DEFAULT 'N' COMMENT '系统内置(Y是 N否)',
    create_by       VARCHAR(64)     DEFAULT '' COMMENT '创建者',
    create_time     DATETIME        DEFAULT NOW() COMMENT '创建时间',
    update_by       VARCHAR(64)     DEFAULT '' COMMENT '更新者',
    update_time     DATETIME        DEFAULT NOW() COMMENT '更新时间',
    remark          VARCHAR(500)    DEFAULT '' COMMENT '备注',
    PRIMARY KEY (id),
    UNIQUE KEY uk_config_key (config_key)
) ENGINE=InnoDB COMMENT='系统配置表';
```

#### 5.4.13 操作日志表 (sys_oper_log)

```sql
CREATE TABLE sys_oper_log (
    id              BIGINT          NOT NULL AUTO_INCREMENT COMMENT '日志ID',
    title           VARCHAR(50)     DEFAULT '' COMMENT '模块标题',
    business_type   INT             DEFAULT 0 COMMENT '业务类型(0其它 1新增 2修改 3删除)',
    method          VARCHAR(100)    DEFAULT '' COMMENT '方法名称',
    request_method  VARCHAR(10)     DEFAULT '' COMMENT '请求方式',
    operator_type   INT             DEFAULT 0 COMMENT '操作类别(0其它 1后台 2手机)',
    oper_name       VARCHAR(50)     DEFAULT '' COMMENT '操作人员',
    dept_name       VARCHAR(50)     DEFAULT '' COMMENT '部门名称',
    oper_url        VARCHAR(255)    DEFAULT '' COMMENT '请求URL',
    oper_ip         VARCHAR(128)    DEFAULT '' COMMENT '主机地址',
    oper_location   VARCHAR(255)    DEFAULT '' COMMENT '操作地点',
    oper_param      VARCHAR(2000)   DEFAULT '' COMMENT '请求参数',
    json_result     VARCHAR(2000)   DEFAULT '' COMMENT '返回参数',
    status          INT             DEFAULT 0 COMMENT '操作状态(0正常 1异常)',
    error_msg       VARCHAR(2000)   DEFAULT '' COMMENT '错误消息',
    oper_time       DATETIME        DEFAULT NOW() COMMENT '操作时间',
    cost_time       BIGINT          DEFAULT 0 COMMENT '消耗时间(毫秒)',
    PRIMARY KEY (id),
    KEY idx_oper_time (oper_time)
) ENGINE=InnoDB COMMENT='操作日志表';
```

#### 5.4.14 登录日志表 (sys_login_log)

```sql
CREATE TABLE sys_login_log (
    id              BIGINT          NOT NULL AUTO_INCREMENT COMMENT '访问ID',
    login_name      VARCHAR(50)     DEFAULT '' COMMENT '登录账号',
    ip_addr         VARCHAR(128)    DEFAULT '' COMMENT '登录IP',
    login_location  VARCHAR(255)    DEFAULT '' COMMENT '登录地点',
    browser         VARCHAR(50)     DEFAULT '' COMMENT '浏览器类型',
    os              VARCHAR(50)     DEFAULT '' COMMENT '操作系统',
    status          CHAR(1)         DEFAULT '0' COMMENT '状态(0成功 1失败)',
    msg             VARCHAR(255)    DEFAULT '' COMMENT '提示消息',
    login_time      DATETIME        DEFAULT NOW() COMMENT '访问时间',
    PRIMARY KEY (id),
    KEY idx_login_time (login_time)
) ENGINE=InnoDB COMMENT='登录日志表';
```

### 5.5 代码生成表设计

#### 5.5.1 代码生成业务表 (gen_table)

```sql
CREATE TABLE gen_table (
    id              BIGINT          NOT NULL AUTO_INCREMENT COMMENT '编号',
    table_name      VARCHAR(200)    DEFAULT '' COMMENT '表名称',
    table_comment   VARCHAR(500)    DEFAULT '' COMMENT '表描述',
    sub_table_name  VARCHAR(64)     DEFAULT NULL COMMENT '关联子表的表名',
    sub_table_fk    VARCHAR(64)     DEFAULT NULL COMMENT '子表关联外键',
    class_name      VARCHAR(100)    DEFAULT '' COMMENT '实体类名称',
    tpl_category    VARCHAR(200)    DEFAULT 'crud' COMMENT '使用的模板(crud单表 tree树表 sub主子表)',
    package_name    VARCHAR(100)    DEFAULT '' COMMENT '生成包路径',
    module_name     VARCHAR(30)     DEFAULT '' COMMENT '生成模块名',
    business_name   VARCHAR(30)     DEFAULT '' COMMENT '生成业务名',
    function_name   VARCHAR(50)     DEFAULT '' COMMENT '生成功能名',
    function_author VARCHAR(50)     DEFAULT '' COMMENT '生成功能作者',
    gen_type        CHAR(1)         DEFAULT '0' COMMENT '生成代码方式(0zip压缩包 1自定义路径)',
    gen_path        VARCHAR(200)    DEFAULT '/' COMMENT '生成路径',
    options         VARCHAR(1000)   DEFAULT '' COMMENT '其它生成选项',
    create_by       VARCHAR(64)     DEFAULT '' COMMENT '创建者',
    create_time     DATETIME        DEFAULT NOW() COMMENT '创建时间',
    update_by       VARCHAR(64)     DEFAULT '' COMMENT '更新者',
    update_time     DATETIME        DEFAULT NOW() COMMENT '更新时间',
    remark          VARCHAR(500)    DEFAULT '' COMMENT '备注',
    PRIMARY KEY (id)
) ENGINE=InnoDB COMMENT='代码生成业务表';
```

#### 5.5.2 代码生成列表 (gen_table_column)

```sql
CREATE TABLE gen_table_column (
    id              BIGINT          NOT NULL AUTO_INCREMENT COMMENT '编号',
    table_id        BIGINT          DEFAULT NULL COMMENT '归属表编号',
    column_name     VARCHAR(200)    DEFAULT '' COMMENT '列名称',
    column_comment  VARCHAR(500)    DEFAULT '' COMMENT '列描述',
    column_type     VARCHAR(100)    DEFAULT '' COMMENT '列类型',
    java_type       VARCHAR(500)    DEFAULT '' COMMENT 'Java类型',
    java_field      VARCHAR(200)    DEFAULT '' COMMENT 'Java字段名',
    is_pk           CHAR(1)         DEFAULT '0' COMMENT '是否主键(1是)',
    is_increment    CHAR(1)         DEFAULT '0' COMMENT '是否自增(1是)',
    is_required     CHAR(1)         DEFAULT '0' COMMENT '是否必填(1是)',
    is_insert       CHAR(1)         DEFAULT '0' COMMENT '是否插入字段(1是)',
    is_edit         CHAR(1)         DEFAULT '0' COMMENT '是否编辑字段(1是)',
    is_list         CHAR(1)         DEFAULT '0' COMMENT '是否列表字段(1是)',
    is_query        CHAR(1)         DEFAULT '0' COMMENT '是否查询字段(1是)',
    query_type      VARCHAR(200)    DEFAULT 'EQ' COMMENT '查询方式(EQ= NE!= GT> GE>= LT< LE<= LIKE BETWEEN)',
    html_type       VARCHAR(200)    DEFAULT '' COMMENT '显示类型(input textarea select checkbox radio datetime)',
    dict_type       VARCHAR(200)    DEFAULT '' COMMENT '字典类型',
    sort            INT             DEFAULT 0 COMMENT '排序',
    create_by       VARCHAR(64)     DEFAULT '' COMMENT '创建者',
    create_time     DATETIME        DEFAULT NOW() COMMENT '创建时间',
    update_by       VARCHAR(64)     DEFAULT '' COMMENT '更新者',
    update_time     DATETIME        DEFAULT NOW() COMMENT '更新时间',
    PRIMARY KEY (id),
    KEY idx_table_id (table_id)
) ENGINE=InnoDB COMMENT='代码生成列表';
```

### 5.6 ER关系图

```
                                    ┌─────────────┐
                                    │  sys_dept   │
                                    │   部门表     │
                                    └──────┬──────┘
                                           │1
                                           │
                                           │N
┌─────────────┐    N:N    ┌─────────────┐  │  ┌─────────────┐
│  sys_role   │◄─────────►│  sys_user   │◄─┘  │  sys_post   │
│   角色表    │           │   用户表     │◄────►│   岗位表    │
└──────┬──────┘           └──────┬──────┘ N:N └─────────────┘
       │                         │
       │N                        │
       │                         │
       │         ┌───────────────┤
       │         │               │
       ▼N        ▼N              ▼N
┌─────────────┐  ┌─────────────┐ ┌─────────────┐
│  sys_menu   │  │sys_user_role│ │sys_user_post│
│   菜单表    │  │用户角色关联  │ │用户岗位关联  │
└─────────────┘  └─────────────┘ └─────────────┘
       ▲N
       │
       │         ┌─────────────┐
       └─────────│sys_role_menu│
                 │角色菜单关联  │
                 └─────────────┘
                        ▲N
                        │
                 ┌──────┴──────┐
                 │sys_role_dept│
                 │角色部门关联  │
                 └─────────────┘
```

---

## 6. 权限管理设计

### 6.1 权限模型概述

采用 **RBAC (Role-Based Access Control)** 模型，实现三层权限控制：

```
┌─────────────────────────────────────────────────────────────────┐
│                        权限控制层级                              │
├─────────────────────────────────────────────────────────────────┤
│  第一层：菜单权限                                                │
│  ├── 控制用户可以看到哪些菜单                                    │
│  └── 通过角色-菜单关联实现                                       │
├─────────────────────────────────────────────────────────────────┤
│  第二层：按钮权限（操作权限）                                     │
│  ├── 控制用户可以执行哪些操作                                    │
│  ├── 权限标识：模块:资源:操作 (如 system:user:add)              │
│  └── 通过注解 @SaCheckPermission 实现                           │
├─────────────────────────────────────────────────────────────────┤
│  第三层：数据权限                                                │
│  ├── 控制用户可以看到哪些数据                                    │
│  ├── 数据范围：全部、自定义、本部门、本部门及以下、仅本人         │
│  └── 通过 @DataScope 注解和 SQL 拦截实现                        │
└─────────────────────────────────────────────────────────────────┘
```

### 6.2 用户-角色-权限关系

```
用户 (User)
  │
  │ 1:N (一个用户可以有多个角色)
  ▼
用户角色关联表 (sys_user_role)
  │
  │ N:1
  ▼
角色 (Role)
  │
  ├─ 1:N ──► 角色菜单关联表 (sys_role_menu) ──► 菜单 (Menu)
  │          - 菜单权限
  │          - 按钮权限 (权限标识 perms)
  │
  └─ 1:N ──► 角色部门关联表 (sys_role_dept) ──► 部门 (Dept)
             - 数据权限（自定义范围时使用）
```

### 6.3 数据权限实现

#### 6.3.1 数据范围定义

| data_scope | 含义 | SQL条件 |
|------------|------|---------|
| 1 | 全部数据 | 无限制 |
| 2 | 自定义数据 | dept_id IN (角色关联的部门ID) |
| 3 | 本部门数据 | dept_id = 用户部门ID |
| 4 | 本部门及以下 | dept_id IN (本部门及子部门ID) |
| 5 | 仅本人数据 | create_by = 当前用户 |

#### 6.3.2 数据权限注解

```java
/**
 * 数据权限注解
 */
@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
public @interface DataScope {
    /**
     * 部门表的别名
     */
    String deptAlias() default "d";

    /**
     * 用户表的别名
     */
    String userAlias() default "u";

    /**
     * 权限字符（用于多角色取并集）
     */
    String permission() default "";
}
```

#### 6.3.3 数据权限切面

```java
@Aspect
@Component
public class DataScopeAspect {

    @Before("@annotation(dataScope)")
    public void doBefore(JoinPoint point, DataScope dataScope) {
        // 获取当前用户
        SysUser user = SecurityUtils.getLoginUser();
        if (user.isAdmin()) {
            return; // 管理员不过滤
        }

        // 构建数据过滤SQL
        StringBuilder sqlString = new StringBuilder();
        List<SysRole> roles = user.getRoles();

        for (SysRole role : roles) {
            String dataScope = role.getDataScope();
            if ("1".equals(dataScope)) {
                // 全部数据
                sqlString = new StringBuilder();
                break;
            } else if ("2".equals(dataScope)) {
                // 自定义数据
                sqlString.append(String.format(
                    " OR %s.dept_id IN (SELECT dept_id FROM sys_role_dept WHERE role_id = %d)",
                    dataScope.deptAlias(), role.getId()
                ));
            } else if ("3".equals(dataScope)) {
                // 本部门数据
                sqlString.append(String.format(
                    " OR %s.dept_id = %d",
                    dataScope.deptAlias(), user.getDeptId()
                ));
            } else if ("4".equals(dataScope)) {
                // 本部门及以下
                sqlString.append(String.format(
                    " OR %s.dept_id IN (SELECT id FROM sys_dept WHERE id = %d OR FIND_IN_SET(%d, ancestors))",
                    dataScope.deptAlias(), user.getDeptId(), user.getDeptId()
                ));
            } else if ("5".equals(dataScope)) {
                // 仅本人
                sqlString.append(String.format(
                    " OR %s.create_by = '%s'",
                    dataScope.userAlias(), user.getLoginName()
                ));
            }
        }

        // 设置到查询参数中
        if (StringUtils.isNotBlank(sqlString.toString())) {
            BaseEntity entity = (BaseEntity) point.getArgs()[0];
            entity.getParams().put("dataScope", " AND (" + sqlString.substring(4) + ")");
        }
    }
}
```

### 6.4 权限验证流程

```
┌──────────────────────────────────────────────────────────────────┐
│                         请求处理流程                              │
└──────────────────────────────────────────────────────────────────┘
                               │
                               ▼
                    ┌─────────────────────┐
                    │    请求到达服务器    │
                    └──────────┬──────────┘
                               │
                               ▼
                    ┌─────────────────────┐
                    │   Token有效性验证    │ ◄── Sa-Token
                    └──────────┬──────────┘
                               │
                    ┌──────────┴──────────┐
                    │                     │
                    ▼                     ▼
              Token有效              Token无效
                    │                     │
                    │                     ▼
                    │         ┌─────────────────┐
                    │         │  返回401未授权   │
                    │         └─────────────────┘
                    ▼
          ┌─────────────────────┐
          │ @SaCheckPermission │ ◄── 权限注解检查
          │  权限标识验证       │
          └──────────┬──────────┘
                     │
          ┌──────────┴──────────┐
          │                     │
          ▼                     ▼
      权限通过              权限不足
          │                     │
          │                     ▼
          │         ┌─────────────────┐
          │         │  返回403禁止    │
          │         └─────────────────┘
          ▼
┌─────────────────────┐
│    @DataScope       │ ◄── 数据权限切面
│    数据范围过滤      │
└──────────┬──────────┘
           │
           ▼
┌─────────────────────┐
│    执行业务逻辑      │
│   返回过滤后数据     │
└─────────────────────┘
```

### 6.5 前端权限控制

#### 6.5.1 权限指令

```typescript
// v-permission 指令
const permissionDirective: Directive = {
  mounted(el: Element, binding: DirectiveBinding) {
    const { value } = binding;
    const permissions = usePermissionStore().permissions;

    if (value && value instanceof Array && value.length > 0) {
      const hasPermission = permissions.some(permission => {
        return value.includes(permission);
      });

      if (!hasPermission) {
        el.parentNode?.removeChild(el);
      }
    }
  }
};

// 使用示例
<a-button v-permission="['system:user:add']">新增</a-button>
```

#### 6.5.2 权限Hook

```typescript
// usePermission.ts
export function usePermission() {
  const permissionStore = usePermissionStore();

  /**
   * 判断是否有权限
   */
  function hasPermission(permission: string | string[]): boolean {
    const permissions = permissionStore.permissions;

    if (typeof permission === 'string') {
      return permissions.includes(permission);
    }

    return permission.some(p => permissions.includes(p));
  }

  /**
   * 判断是否有角色
   */
  function hasRole(role: string | string[]): boolean {
    const roles = permissionStore.roles;

    if (typeof role === 'string') {
      return roles.includes(role);
    }

    return role.some(r => roles.includes(r));
  }

  return {
    hasPermission,
    hasRole
  };
}
```

---

## 7. 菜单配置设计

### 7.1 菜单类型定义

| 类型 | 标识 | 说明 |
|------|------|------|
| 目录 | M | 左侧菜单目录，可包含子菜单 |
| 菜单 | C | 具体页面菜单，关联组件 |
| 按钮 | F | 页面内按钮，仅用于权限控制 |

### 7.2 菜单数据结构

```typescript
interface Menu {
  id: number;                  // 菜单ID
  menuName: string;            // 菜单名称
  parentId: number;            // 父菜单ID
  orderNum: number;            // 显示顺序
  path: string;                // 路由地址
  component: string;           // 组件路径
  query: string;               // 路由参数
  isFrame: string;             // 是否外链(0是 1否)
  isCache: string;             // 是否缓存(0缓存 1不缓存)
  menuType: string;            // 菜单类型(M目录 C菜单 F按钮)
  visible: string;             // 显示状态(0显示 1隐藏)
  status: string;              // 菜单状态(0正常 1停用)
  perms: string;               // 权限标识
  icon: string;                // 菜单图标
  children?: Menu[];           // 子菜单
}
```

### 7.3 动态路由生成

#### 7.3.1 后端返回菜单数据

```json
{
  "code": 200,
  "data": [
    {
      "name": "System",
      "path": "/system",
      "hidden": false,
      "redirect": "noRedirect",
      "component": "Layout",
      "meta": {
        "title": "系统管理",
        "icon": "setting",
        "noCache": false
      },
      "children": [
        {
          "name": "User",
          "path": "user",
          "hidden": false,
          "component": "system/user/index",
          "meta": {
            "title": "用户管理",
            "icon": "user",
            "noCache": false
          }
        },
        {
          "name": "Role",
          "path": "role",
          "hidden": false,
          "component": "system/role/index",
          "meta": {
            "title": "角色管理",
            "icon": "peoples",
            "noCache": false
          }
        }
      ]
    }
  ]
}
```

#### 7.3.2 前端路由转换

```typescript
// 动态路由转换
function generateRoutes(menus: Menu[]): RouteRecordRaw[] {
  const routes: RouteRecordRaw[] = [];

  menus.forEach(menu => {
    const route: RouteRecordRaw = {
      path: menu.path,
      name: menu.name,
      component: loadComponent(menu.component),
      meta: {
        title: menu.meta.title,
        icon: menu.meta.icon,
        noCache: menu.meta.noCache,
        hidden: menu.hidden
      }
    };

    if (menu.children && menu.children.length > 0) {
      route.children = generateRoutes(menu.children);
    }

    routes.push(route);
  });

  return routes;
}

// 动态加载组件
function loadComponent(component: string) {
  if (component === 'Layout') {
    return () => import('@/layouts/default/index.vue');
  }
  return () => import(`@/views/${component}.vue`);
}
```

### 7.4 菜单权限标识规范

```
权限标识格式：模块名:资源名:操作名

系统管理模块示例：
├── system:user:list      - 用户列表
├── system:user:query     - 用户查询
├── system:user:add       - 用户新增
├── system:user:edit      - 用户修改
├── system:user:delete    - 用户删除
├── system:user:export    - 用户导出
├── system:user:import    - 用户导入
├── system:user:resetPwd  - 重置密码
├── system:role:list      - 角色列表
├── system:role:query     - 角色查询
├── system:role:add       - 角色新增
├── system:role:edit      - 角色修改
├── system:role:delete    - 角色删除
├── system:menu:list      - 菜单列表
├── system:menu:query     - 菜单查询
├── system:menu:add       - 菜单新增
├── system:menu:edit      - 菜单修改
└── system:menu:delete    - 菜单删除
```

---

## 8. 代码生成器设计

### 8.1 代码生成流程

```
┌─────────────────────────────────────────────────────────────────┐
│                       代码生成流程                               │
└─────────────────────────────────────────────────────────────────┘

     ┌─────────────┐
     │  选择数据表  │ ◄── 从数据库读取表信息
     └──────┬──────┘
            │
            ▼
     ┌─────────────┐
     │  导入表结构  │ ◄── 解析表字段、注释、类型
     └──────┬──────┘
            │
            ▼
     ┌─────────────┐
     │  配置生成项  │ ◄── 包名、模块名、功能名等
     └──────┬──────┘
            │
            ▼
     ┌─────────────┐
     │  字段配置   │ ◄── 显示类型、查询方式、字典等
     └──────┬──────┘
            │
            ▼
     ┌─────────────┐
     │  选择模板   │ ◄── 单表、树表、主子表
     └──────┬──────┘
            │
            ▼
     ┌─────────────┐
     │  预览代码   │ ◄── 查看生成效果
     └──────┬──────┘
            │
            ▼
     ┌─────────────┐
     │  生成代码   │ ◄── 下载ZIP或直接生成到项目
     └─────────────┘
```

### 8.2 生成模板类型

| 模板类型 | 说明 | 适用场景 |
|---------|------|---------|
| crud | 单表CRUD | 普通业务表 |
| tree | 树形表CRUD | 分类、部门等树形结构 |
| sub | 主子表CRUD | 订单-订单明细等一对多关系 |

### 8.3 生成文件清单

#### 8.3.1 后端文件

| 文件 | 说明 | 模板 |
|------|------|------|
| Entity.java | 实体类 | entity.java.ftl |
| Mapper.java | 数据访问接口 | mapper.java.ftl |
| Mapper.xml | MyBatis映射文件 | mapper.xml.ftl |
| Service.java | 服务接口 | service.java.ftl |
| ServiceImpl.java | 服务实现 | serviceImpl.java.ftl |
| Controller.java | 控制器 | controller.java.ftl |

#### 8.3.2 前端文件

| 文件 | 说明 | 模板 |
|------|------|------|
| index.vue | 列表页面 | index.vue.ftl |
| form.vue | 表单页面 | form.vue.ftl |
| api.ts | 接口定义 | api.ts.ftl |

### 8.4 模板变量说明

```java
/**
 * 模板上下文变量
 */
public class GenContext {
    // 表信息
    String tableName;           // 表名
    String tableComment;        // 表注释
    String className;           // 类名(首字母大写)
    String classname;           // 类名(首字母小写)

    // 生成配置
    String packageName;         // 包路径
    String moduleName;          // 模块名
    String businessName;        // 业务名
    String functionName;        // 功能名
    String functionAuthor;      // 作者

    // 字段信息
    List<GenTableColumn> columns;      // 所有字段
    GenTableColumn pkColumn;           // 主键字段
    List<GenTableColumn> insertColumns;// 插入字段
    List<GenTableColumn> editColumns;  // 编辑字段
    List<GenTableColumn> listColumns;  // 列表字段
    List<GenTableColumn> queryColumns; // 查询字段

    // 树表额外变量
    String treeCode;            // 树编码字段
    String treeName;            // 树名称字段
    String treeParentCode;      // 树父编码字段

    // 主子表额外变量
    GenTable subTable;          // 子表信息
    List<GenTableColumn> subColumns; // 子表字段
}
```

### 8.5 核心模板示例

#### 8.5.1 Controller模板 (controller.java.ftl)

```ftl
package ${packageName}.controller;

import java.util.List;
import javax.servlet.http.HttpServletResponse;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.*;
import cn.dev33.satoken.annotation.SaCheckPermission;
import ${packageName}.entity.${ClassName};
import ${packageName}.service.I${ClassName}Service;
import com.jsite.common.core.domain.R;
import com.jsite.common.core.page.TableDataInfo;
import com.jsite.common.annotation.Log;
import com.jsite.common.enums.BusinessType;

/**
 * ${functionName}Controller
 *
 * @author ${author}
 * @date ${datetime}
 */
@RestController
@RequestMapping("/${moduleName}/${businessName}")
public class ${ClassName}Controller {

    @Autowired
    private I${ClassName}Service ${classname}Service;

    /**
     * 查询${functionName}列表
     */
    @SaCheckPermission("${moduleName}:${businessName}:list")
    @GetMapping("/list")
    public TableDataInfo list(${ClassName} ${classname}) {
        startPage();
        List<${ClassName}> list = ${classname}Service.selectList(${classname});
        return getDataTable(list);
    }

    /**
     * 获取${functionName}详细信息
     */
    @SaCheckPermission("${moduleName}:${businessName}:query")
    @GetMapping("/{${pkColumn.javaField}}")
    public R<${ClassName}> getInfo(@PathVariable ${pkColumn.javaType} ${pkColumn.javaField}) {
        return R.ok(${classname}Service.selectById(${pkColumn.javaField}));
    }

    /**
     * 新增${functionName}
     */
    @SaCheckPermission("${moduleName}:${businessName}:add")
    @Log(title = "${functionName}", businessType = BusinessType.INSERT)
    @PostMapping
    public R<Void> add(@RequestBody ${ClassName} ${classname}) {
        return toAjax(${classname}Service.insert(${classname}));
    }

    /**
     * 修改${functionName}
     */
    @SaCheckPermission("${moduleName}:${businessName}:edit")
    @Log(title = "${functionName}", businessType = BusinessType.UPDATE)
    @PutMapping
    public R<Void> edit(@RequestBody ${ClassName} ${classname}) {
        return toAjax(${classname}Service.update(${classname}));
    }

    /**
     * 删除${functionName}
     */
    @SaCheckPermission("${moduleName}:${businessName}:delete")
    @Log(title = "${functionName}", businessType = BusinessType.DELETE)
    @DeleteMapping("/{${pkColumn.javaField}s}")
    public R<Void> remove(@PathVariable ${pkColumn.javaType}[] ${pkColumn.javaField}s) {
        return toAjax(${classname}Service.deleteByIds(${pkColumn.javaField}s));
    }

    /**
     * 导出${functionName}列表
     */
    @SaCheckPermission("${moduleName}:${businessName}:export")
    @Log(title = "${functionName}", businessType = BusinessType.EXPORT)
    @PostMapping("/export")
    public void export(HttpServletResponse response, ${ClassName} ${classname}) {
        List<${ClassName}> list = ${classname}Service.selectList(${classname});
        ExcelUtil.exportExcel(list, "${functionName}数据", ${ClassName}.class, response);
    }
}
```

#### 8.5.2 Vue列表页模板 (index.vue.ftl)

```ftl
<template>
  <div class="app-container">
    <!-- 搜索表单 -->
    <a-form ref="queryFormRef" :model="queryParams" layout="inline" v-show="showSearch">
<#list queryColumns as column>
  <#if column.htmlType == "input">
      <a-form-item label="${column.columnComment}" name="${column.javaField}">
        <a-input v-model:value="queryParams.${column.javaField}" placeholder="请输入${column.columnComment}" allow-clear />
      </a-form-item>
  <#elseif column.htmlType == "select">
      <a-form-item label="${column.columnComment}" name="${column.javaField}">
        <a-select v-model:value="queryParams.${column.javaField}" placeholder="请选择${column.columnComment}" allow-clear>
          <a-select-option v-for="dict in ${column.dictType}Options" :key="dict.value" :value="dict.value">
            {{ dict.label }}
          </a-select-option>
        </a-select>
      </a-form-item>
  <#elseif column.htmlType == "datetime">
      <a-form-item label="${column.columnComment}" name="${column.javaField}">
        <a-range-picker v-model:value="queryParams.${column.javaField}" />
      </a-form-item>
  </#if>
</#list>
      <a-form-item>
        <a-space>
          <a-button type="primary" @click="handleQuery">
            <SearchOutlined /> 搜索
          </a-button>
          <a-button @click="resetQuery">
            <ReloadOutlined /> 重置
          </a-button>
        </a-space>
      </a-form-item>
    </a-form>

    <!-- 操作按钮 -->
    <a-row :gutter="10" class="mb8">
      <a-col :span="1.5">
        <a-button type="primary" @click="handleAdd" v-permission="['${moduleName}:${businessName}:add']">
          <PlusOutlined /> 新增
        </a-button>
      </a-col>
      <a-col :span="1.5">
        <a-button type="primary" danger :disabled="multiple" @click="handleDelete" v-permission="['${moduleName}:${businessName}:delete']">
          <DeleteOutlined /> 删除
        </a-button>
      </a-col>
      <a-col :span="1.5">
        <a-button type="primary" @click="handleExport" v-permission="['${moduleName}:${businessName}:export']">
          <DownloadOutlined /> 导出
        </a-button>
      </a-col>
    </a-row>

    <!-- 数据表格 -->
    <a-table
      :columns="columns"
      :data-source="tableData"
      :loading="loading"
      :pagination="pagination"
      :row-selection="{ selectedRowKeys, onChange: onSelectChange }"
      row-key="${pkColumn.javaField}"
      @change="handleTableChange"
    >
      <template #bodyCell="{ column, record }">
<#list listColumns as column>
  <#if column.dictType?? && column.dictType != "">
        <template v-if="column.dataIndex === '${column.javaField}'">
          <dict-tag :options="${column.dictType}Options" :value="record.${column.javaField}" />
        </template>
  </#if>
</#list>
        <template v-if="column.dataIndex === 'action'">
          <a-space>
            <a @click="handleUpdate(record)" v-permission="['${moduleName}:${businessName}:edit']">
              <EditOutlined /> 修改
            </a>
            <a-popconfirm title="确认删除?" @confirm="handleDelete(record)">
              <a class="text-danger" v-permission="['${moduleName}:${businessName}:delete']">
                <DeleteOutlined /> 删除
              </a>
            </a-popconfirm>
          </a-space>
        </template>
      </template>
    </a-table>

    <!-- 表单弹窗 -->
    <${ClassName}Form ref="formRef" @success="getList" />
  </div>
</template>

<script setup lang="ts">
import { ref, reactive, onMounted } from 'vue';
import { list${ClassName}, del${ClassName}, export${ClassName} } from '@/api/${moduleName}/${businessName}';
import ${ClassName}Form from './${ClassName}Form.vue';

const queryFormRef = ref();
const formRef = ref();
const loading = ref(false);
const showSearch = ref(true);
const tableData = ref([]);
const selectedRowKeys = ref<number[]>([]);
const multiple = ref(true);

const queryParams = reactive({
<#list queryColumns as column>
  ${column.javaField}: undefined,
</#list>
  pageNum: 1,
  pageSize: 10
});

const columns = [
<#list listColumns as column>
  { title: '${column.columnComment}', dataIndex: '${column.javaField}', key: '${column.javaField}' },
</#list>
  { title: '操作', dataIndex: 'action', key: 'action', width: 150 }
];

const pagination = reactive({
  current: 1,
  pageSize: 10,
  total: 0,
  showSizeChanger: true,
  showTotal: (total: number) => `共 ${r'${total}'} 条`
});

/** 查询列表 */
async function getList() {
  loading.value = true;
  try {
    const res = await list${ClassName}(queryParams);
    tableData.value = res.rows;
    pagination.total = res.total;
  } finally {
    loading.value = false;
  }
}

/** 搜索按钮操作 */
function handleQuery() {
  queryParams.pageNum = 1;
  getList();
}

/** 重置按钮操作 */
function resetQuery() {
  queryFormRef.value?.resetFields();
  handleQuery();
}

/** 新增按钮操作 */
function handleAdd() {
  formRef.value?.open();
}

/** 修改按钮操作 */
function handleUpdate(row: any) {
  formRef.value?.open(row.${pkColumn.javaField});
}

/** 删除按钮操作 */
async function handleDelete(row?: any) {
  const ids = row?.${pkColumn.javaField} || selectedRowKeys.value;
  await del${ClassName}(ids);
  getList();
}

/** 导出按钮操作 */
function handleExport() {
  export${ClassName}(queryParams);
}

/** 多选框选中数据 */
function onSelectChange(keys: number[]) {
  selectedRowKeys.value = keys;
  multiple.value = !keys.length;
}

/** 分页变化 */
function handleTableChange(pag: any) {
  queryParams.pageNum = pag.current;
  queryParams.pageSize = pag.pageSize;
  getList();
}

onMounted(() => {
  getList();
});
</script>
```

---

## 9. API设计规范

### 9.1 RESTful规范

| HTTP方法 | 语义 | 示例 |
|----------|------|------|
| GET | 查询资源 | GET /api/system/user/{id} |
| POST | 新增资源 | POST /api/system/user |
| PUT | 更新资源 | PUT /api/system/user |
| DELETE | 删除资源 | DELETE /api/system/user/{id} |

### 9.2 统一响应格式

```java
/**
 * 统一响应结果
 */
@Data
public class R<T> implements Serializable {

    /** 状态码 */
    private int code;

    /** 消息 */
    private String msg;

    /** 数据 */
    private T data;

    public static <T> R<T> ok() {
        return restResult(null, 200, "操作成功");
    }

    public static <T> R<T> ok(T data) {
        return restResult(data, 200, "操作成功");
    }

    public static <T> R<T> ok(T data, String msg) {
        return restResult(data, 200, msg);
    }

    public static <T> R<T> fail() {
        return restResult(null, 500, "操作失败");
    }

    public static <T> R<T> fail(String msg) {
        return restResult(null, 500, msg);
    }

    public static <T> R<T> fail(int code, String msg) {
        return restResult(null, code, msg);
    }

    private static <T> R<T> restResult(T data, int code, String msg) {
        R<T> r = new R<>();
        r.setCode(code);
        r.setData(data);
        r.setMsg(msg);
        return r;
    }
}
```

### 9.3 分页响应格式

```java
/**
 * 分页数据
 */
@Data
public class TableDataInfo implements Serializable {

    /** 总记录数 */
    private long total;

    /** 列表数据 */
    private List<?> rows;

    /** 消息状态码 */
    private int code;

    /** 消息内容 */
    private String msg;
}
```

### 9.4 错误码定义

| 错误码 | 说明 |
|-------|------|
| 200 | 操作成功 |
| 400 | 请求参数错误 |
| 401 | 未登录或Token过期 |
| 403 | 没有操作权限 |
| 404 | 资源不存在 |
| 500 | 服务器内部错误 |
| 501 | 业务异常 |

### 9.5 接口路径规范

```
/api                         # API统一前缀
├── /auth                    # 认证相关
│   ├── POST /login          # 登录
│   ├── POST /logout         # 登出
│   ├── GET  /captcha        # 获取验证码
│   └── GET  /info           # 获取用户信息
│
├── /system                  # 系统管理
│   ├── /user                # 用户管理
│   │   ├── GET    /list     # 用户列表
│   │   ├── GET    /{id}     # 用户详情
│   │   ├── POST   /         # 新增用户
│   │   ├── PUT    /         # 修改用户
│   │   ├── DELETE /{ids}    # 删除用户
│   │   └── PUT    /resetPwd # 重置密码
│   │
│   ├── /role                # 角色管理
│   ├── /menu                # 菜单管理
│   ├── /dept                # 部门管理
│   ├── /post                # 岗位管理
│   ├── /dict                # 字典管理
│   └── /config              # 配置管理
│
├── /monitor                 # 系统监控
│   ├── /operlog             # 操作日志
│   ├── /loginlog            # 登录日志
│   └── /online              # 在线用户
│
└── /gen                     # 代码生成
    ├── GET  /list           # 表列表
    ├── GET  /db/list        # 数据库表列表
    ├── POST /importTable    # 导入表
    ├── GET  /{tableId}      # 表详情
    ├── PUT  /               # 修改配置
    ├── GET  /preview/{id}   # 预览代码
    ├── GET  /download/{id}  # 下载代码
    └── GET  /genCode/{id}   # 生成代码
```

---

## 10. 前端架构设计

### 10.1 目录结构规范

```
src/
├── api/                # 接口定义层
│   └── [module]/       # 按模块组织
│       └── [resource].ts
│
├── assets/             # 静态资源
│   ├── icons/          # 图标
│   ├── images/         # 图片
│   └── styles/         # 样式
│
├── components/         # 通用组件
│   └── [Component]/    # 组件目录
│       ├── src/        # 组件源码
│       └── index.ts    # 组件导出
│
├── directives/         # 自定义指令
├── hooks/              # 组合式函数
├── layouts/            # 布局组件
├── router/             # 路由配置
├── store/              # 状态管理
├── utils/              # 工具函数
│
└── views/              # 页面视图
    └── [module]/       # 按模块组织
        └── [page]/     # 页面目录
            ├── index.vue       # 主页面
            ├── components/     # 页面私有组件
            └── hooks/          # 页面私有hooks
```

### 10.2 组件设计原则

1. **单一职责**：每个组件只负责一个功能
2. **Props向下，Events向上**：数据流单向流动
3. **组合优于继承**：使用组合式API和hooks复用逻辑
4. **类型安全**：使用TypeScript定义Props和Emits

### 10.3 状态管理设计

```typescript
// store/modules/user.ts
import { defineStore } from 'pinia';
import { login, logout, getInfo } from '@/api/login';
import { getToken, setToken, removeToken } from '@/utils/auth';

interface UserState {
  token: string;
  id: number | null;
  name: string;
  avatar: string;
  roles: string[];
  permissions: string[];
}

export const useUserStore = defineStore('user', {
  state: (): UserState => ({
    token: getToken() || '',
    id: null,
    name: '',
    avatar: '',
    roles: [],
    permissions: []
  }),

  actions: {
    /** 登录 */
    async login(loginForm: LoginForm) {
      const res = await login(loginForm);
      this.token = res.token;
      setToken(res.token);
    },

    /** 获取用户信息 */
    async getInfo() {
      const res = await getInfo();
      this.id = res.user.id;
      this.name = res.user.userName;
      this.avatar = res.user.avatar;
      this.roles = res.roles;
      this.permissions = res.permissions;
    },

    /** 登出 */
    async logout() {
      await logout();
      this.token = '';
      this.roles = [];
      this.permissions = [];
      removeToken();
    }
  }
});
```

### 10.4 请求封装

```typescript
// utils/http/axios.ts
import axios, { AxiosInstance, AxiosRequestConfig, AxiosResponse } from 'axios';
import { message } from 'ant-design-vue';
import { useUserStore } from '@/store/modules/user';
import { getToken } from '@/utils/auth';

// 创建axios实例
const service: AxiosInstance = axios.create({
  baseURL: import.meta.env.VITE_API_BASE_URL,
  timeout: 30000
});

// 请求拦截器
service.interceptors.request.use(
  (config: AxiosRequestConfig) => {
    const token = getToken();
    if (token) {
      config.headers = config.headers || {};
      config.headers['Authorization'] = `Bearer ${token}`;
    }
    return config;
  },
  (error) => {
    return Promise.reject(error);
  }
);

// 响应拦截器
service.interceptors.response.use(
  (response: AxiosResponse) => {
    const res = response.data;

    if (res.code !== 200) {
      message.error(res.msg || '请求失败');

      // Token过期
      if (res.code === 401) {
        const userStore = useUserStore();
        userStore.logout();
        location.href = '/login';
      }

      return Promise.reject(new Error(res.msg || 'Error'));
    }

    return res;
  },
  (error) => {
    message.error(error.message || '网络错误');
    return Promise.reject(error);
  }
);

export default service;
```

---

## 11. 部署方案

### 11.1 开发环境

```yaml
# docker-compose-dev.yml
version: '3.8'
services:
  mysql:
    image: mysql:8.0
    container_name: jsite-mysql
    environment:
      MYSQL_ROOT_PASSWORD: root123
      MYSQL_DATABASE: jsite
    ports:
      - "3306:3306"
    volumes:
      - mysql-data:/var/lib/mysql

  redis:
    image: redis:7-alpine
    container_name: jsite-redis
    ports:
      - "6379:6379"
    volumes:
      - redis-data:/data

volumes:
  mysql-data:
  redis-data:
```

### 11.2 生产环境架构

```
                    ┌─────────────────┐
                    │     Nginx       │
                    │  负载均衡/SSL    │
                    └────────┬────────┘
                             │
              ┌──────────────┼──────────────┐
              │              │              │
              ▼              ▼              ▼
       ┌──────────┐   ┌──────────┐   ┌──────────┐
       │ 前端静态  │   │ 后端服务1 │   │ 后端服务2 │
       │  (Vue)   │   │ (Spring) │   │ (Spring) │
       └──────────┘   └─────┬────┘   └─────┬────┘
                            │              │
                            └──────┬───────┘
                                   │
                    ┌──────────────┼──────────────┐
                    │              │              │
                    ▼              ▼              ▼
             ┌──────────┐  ┌──────────┐  ┌──────────┐
             │  MySQL   │  │   Redis  │  │  MinIO   │
             │  主从    │  │   集群   │  │  文件存储 │
             └──────────┘  └──────────┘  └──────────┘
```

### 11.3 Nginx配置

```nginx
# jsite.conf
upstream backend {
    server 127.0.0.1:8080 weight=5;
    server 127.0.0.1:8081 weight=5;
}

server {
    listen 80;
    server_name jsite.example.com;
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name jsite.example.com;

    ssl_certificate /etc/nginx/ssl/jsite.crt;
    ssl_certificate_key /etc/nginx/ssl/jsite.key;

    # 前端静态资源
    location / {
        root /usr/share/nginx/html/jsite;
        index index.html;
        try_files $uri $uri/ /index.html;
    }

    # 后端API代理
    location /api/ {
        proxy_pass http://backend/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # WebSocket代理
    location /ws/ {
        proxy_pass http://backend/ws/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
    }
}
```

---

## 12. 开发规范

### 12.1 代码规范

#### Java规范
- 遵循阿里巴巴Java开发手册
- 使用Lombok简化代码
- 统一使用SLF4J日志框架
- 方法注释使用Javadoc格式

#### Vue/TypeScript规范
- 遵循Vue3官方风格指南
- 组件名使用PascalCase
- Props定义使用TypeScript接口
- 使用ESLint + Prettier格式化

### 12.2 Git规范

#### 分支管理
- main: 生产分支
- develop: 开发分支
- feature/*: 功能分支
- hotfix/*: 紧急修复分支

#### 提交信息
```
<type>(<scope>): <subject>

类型(type):
- feat: 新功能
- fix: 修复bug
- docs: 文档更新
- style: 代码格式
- refactor: 重构
- test: 测试
- chore: 构建/工具
```

### 12.3 接口文档

使用Knife4j自动生成API文档：
- 访问地址：http://localhost:8080/doc.html
- 支持在线调试
- 支持导出离线文档

---

## 附录

### A. 技术选型对比

| 功能 | JeeSite选型 | JSite选型 | 选择理由 |
|------|------------|----------|---------|
| 安全框架 | Shiro | Sa-Token | 更轻量、API更友好 |
| ORM框架 | MyBatis自定义 | MyBatis-Plus | 功能更完善、开发效率更高 |
| 前端UI | Ant Design Vue | Ant Design Vue | 企业级、组件丰富 |
| 状态管理 | Pinia | Pinia | Vue3官方推荐 |

### B. 参考资料

- Spring Boot官方文档: https://spring.io/projects/spring-boot
- Sa-Token文档: https://sa-token.cc/
- MyBatis-Plus文档: https://baomidou.com/
- Vue3文档: https://cn.vuejs.org/
- Ant Design Vue: https://antdv.com/

---

**文档版本历史**

| 版本 | 日期 | 作者 | 说明 |
|------|------|------|------|
| 1.0.0 | 2026-01-15 | JSite Team | 初始版本 |
